Yes, this script is a total mess.  
I have done it a long time ago, back to PHP5 era.  
But it never really failed me during all the years I used it so...  
  
It can be used via shell or hosted on a web server, not tested on newer PHP versions.  
  